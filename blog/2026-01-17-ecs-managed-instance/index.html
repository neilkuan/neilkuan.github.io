<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage"><head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="icon" href="/favicon.ico">

  <title>
  New 2025 Amazon ECS Managed Instance Support - Neil Kuan
  </title>
  <meta name="description" content="sources:
https://aws.amazon.com/tw/about-aws/whats-new/2025/09/amazon-ecs-managed-instances/ https://aws.amazon.com/tw/about-aws/whats-new/2025/12/amazon-ecs-managed-instances-ec2-spot-instances/ Fast Nginx Task Startup with ECS Managed Instances ä½¿ç”¨ ECS Managed Instances å¿«é€Ÿå•Ÿå‹• Nginx ä»»å‹™ This project demonstrates how to use Amazon ECS Managed Instances with Terraform to quickly bring up an ECS service running Nginx. æœ¬å°ˆæ¡ˆå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Terraform æ­é… Amazon ECS Managed Instances å¿«é€Ÿå•Ÿå‹•é‹è¡Œ Nginx çš„ ECS æœå‹™ã€‚
We also measure how long it takes from requesting a single task to the moment the application starts logging â€” roughly 40 seconds end-to-end." /><meta name="generator" content="Hugo 0.115.0"><link
    rel="stylesheet"
    href="https://blog.neilkuan.click/css/styles.min.eb7fe02195897f2fd20b6dcb5f80cda854ce0b58dcf3a28f1d23166a1eaaded4.css"
    integrity="sha256-63/gIZWJfy/SC23LX4DNqFTOC1jc86KPHSMWah6q3tQ="
  />
  
  

  <meta property="og:title" content="New 2025 Amazon ECS Managed Instance Support" />
<meta property="og:description" content="sources:
https://aws.amazon.com/tw/about-aws/whats-new/2025/09/amazon-ecs-managed-instances/ https://aws.amazon.com/tw/about-aws/whats-new/2025/12/amazon-ecs-managed-instances-ec2-spot-instances/ Fast Nginx Task Startup with ECS Managed Instances ä½¿ç”¨ ECS Managed Instances å¿«é€Ÿå•Ÿå‹• Nginx ä»»å‹™ This project demonstrates how to use Amazon ECS Managed Instances with Terraform to quickly bring up an ECS service running Nginx. æœ¬å°ˆæ¡ˆå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Terraform æ­é… Amazon ECS Managed Instances å¿«é€Ÿå•Ÿå‹•é‹è¡Œ Nginx çš„ ECS æœå‹™ã€‚
We also measure how long it takes from requesting a single task to the moment the application starts logging â€” roughly 40 seconds end-to-end." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.neilkuan.click/blog/2026-01-17-ecs-managed-instance/" /><meta property="og:image" content="https://blog.neilkuan.click/img/2026-01-17-ecs-managed-instance/gpt.png" /><meta property="article:section" content="blog" />
<meta property="article:published_time" content="2026-01-17T00:00:00+00:00" />
<meta property="article:modified_time" content="2026-01-17T00:00:00+00:00" />

  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://blog.neilkuan.click/img/2026-01-17-ecs-managed-instance/gpt.png"/>

<meta name="twitter:title" content="New 2025 Amazon ECS Managed Instance Support"/>
<meta name="twitter:description" content="sources:
https://aws.amazon.com/tw/about-aws/whats-new/2025/09/amazon-ecs-managed-instances/ https://aws.amazon.com/tw/about-aws/whats-new/2025/12/amazon-ecs-managed-instances-ec2-spot-instances/ Fast Nginx Task Startup with ECS Managed Instances ä½¿ç”¨ ECS Managed Instances å¿«é€Ÿå•Ÿå‹• Nginx ä»»å‹™ This project demonstrates how to use Amazon ECS Managed Instances with Terraform to quickly bring up an ECS service running Nginx. æœ¬å°ˆæ¡ˆå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Terraform æ­é… Amazon ECS Managed Instances å¿«é€Ÿå•Ÿå‹•é‹è¡Œ Nginx çš„ ECS æœå‹™ã€‚
We also measure how long it takes from requesting a single task to the moment the application starts logging â€” roughly 40 seconds end-to-end."/>

  <meta itemprop="name" content="New 2025 Amazon ECS Managed Instance Support">
<meta itemprop="description" content="sources:
https://aws.amazon.com/tw/about-aws/whats-new/2025/09/amazon-ecs-managed-instances/ https://aws.amazon.com/tw/about-aws/whats-new/2025/12/amazon-ecs-managed-instances-ec2-spot-instances/ Fast Nginx Task Startup with ECS Managed Instances ä½¿ç”¨ ECS Managed Instances å¿«é€Ÿå•Ÿå‹• Nginx ä»»å‹™ This project demonstrates how to use Amazon ECS Managed Instances with Terraform to quickly bring up an ECS service running Nginx. æœ¬å°ˆæ¡ˆå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Terraform æ­é… Amazon ECS Managed Instances å¿«é€Ÿå•Ÿå‹•é‹è¡Œ Nginx çš„ ECS æœå‹™ã€‚
We also measure how long it takes from requesting a single task to the moment the application starts logging â€” roughly 40 seconds end-to-end."><meta itemprop="datePublished" content="2026-01-17T00:00:00+00:00" />
<meta itemprop="dateModified" content="2026-01-17T00:00:00+00:00" />
<meta itemprop="wordCount" content="1663"><meta itemprop="image" content="https://blog.neilkuan.click/img/2026-01-17-ecs-managed-instance/gpt.png">
<meta itemprop="keywords" content="" />

  
</head>
<body class="dark:bg-gray-800 dark:text-white relative flex flex-col min-h-screen"><header class="container flex justify-between md:justify-between gap-4 flex-wrap p-6 mx-auto relative">
  <a href="https://blog.neilkuan.click/" class="capitalize font-extrabold text-2xl">
    
    Neil Kuan
    
  </a>
  <button class="mobile-menu-button md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <line x1="4" y1="8" x2="20" y2="8" />
      <line x1="4" y1="16" x2="20" y2="16" />
    </svg>
  </button>
  <ul class="mobile-menu absolute z-10 px-6 pb-6 md:p-0 top-full left-0 w-full md:w-auto md:relative hidden md:flex flex-col md:flex-row items-end md:items-center gap-4 lg:gap-6 bg-white dark:bg-gray-800">

    
    <li><a href="/blog">Blog</a></li>
    
    <li><a href="/about">About</a></li>
    

    

    
    <li class="grid place-items-center">
      <span class="open-search inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="10" cy="10" r="7" />
          <line x1="21" y1="21" x2="15" y2="15" />
        </svg>
      </span>
    </li>
    

    
    <li class="grid place-items-center">
      <span class="toggle-dark-mode inline-block cursor-pointer">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <circle cx="12" cy="12" r="3" />
          <line x1="12" y1="5" x2="12" y2="5.01" />
          <line x1="17" y1="7" x2="17" y2="7.01" />
          <line x1="19" y1="12" x2="19" y2="12.01" />
          <line x1="17" y1="17" x2="17" y2="17.01" />
          <line x1="12" y1="19" x2="12" y2="19.01" />
          <line x1="7" y1="17" x2="7" y2="17.01" />
          <line x1="5" y1="12" x2="5" y2="12.01" />
          <line x1="7" y1="7" x2="7" y2="7.01" />
        </svg>
      </span>
    </li>
    
  </ul>
</header>
<main class="flex-1">
  
  

  
  <div class="relative max-w-5xl mx-auto px-4">
    <img src="/img/2026-01-17-ecs-managed-instance/gpt.png" class="rounded-lg shadow-sm w-full object-contain" />
    
    <div class="absolute top-4 right-8 rounded shadow bg-white text-gray-900 dark:bg-gray-900 dark:text-white px-2 py-0.5">
      
  
    January 17, 2026
  


    </div>
    
  </div>
  

  <article class="prose lg:prose-lg mx-auto my-8 dark:prose-dark px-4">

    <h1 class="text-2xl font-bold mb-2">New 2025 Amazon ECS Managed Instance Support</h1>
    
    <h5 class="text-sm flex items-center flex-wrap">
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <rect x="4" y="5" width="16" height="16" rx="2" />
        <line x1="16" y1="3" x2="16" y2="7" />
        <line x1="8" y1="3" x2="8" y2="7" />
        <line x1="4" y1="11" x2="20" y2="11" />
        <rect x="8" y="15" width="2" height="2" />
      </svg>
      Posted on 
  
    January 17, 2026
  


      
        &nbsp;&bull;&nbsp;
      
      <svg xmlns="http://www.w3.org/2000/svg" class="mr-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <circle cx="12" cy="12" r="9" />
        <polyline points="12 7 12 12 15 15" />
      </svg>
      8&nbsp;minutes
      &nbsp;&bull;
      <svg xmlns="http://www.w3.org/2000/svg" class="mx-1" width="16" height="16" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
        <path d="M3 19a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <path d="M3 6a9 9 0 0 1 9 0a9 9 0 0 1 9 0" />
        <line x1="3" y1="6" x2="3" y2="19" />
        <line x1="12" y1="6" x2="12" y2="19" />
        <line x1="21" y1="6" x2="21" y2="19" />
      </svg>
      1663&nbsp;words
      
    </h5>
    

    

    <p>sources:</p>
<ul>
<li><a href="https://aws.amazon.com/tw/about-aws/whats-new/2025/09/amazon-ecs-managed-instances/" target="_blank" rel="noopener">https://aws.amazon.com/tw/about-aws/whats-new/2025/09/amazon-ecs-managed-instances/</a>
</li>
<li><a href="https://aws.amazon.com/tw/about-aws/whats-new/2025/12/amazon-ecs-managed-instances-ec2-spot-instances/" target="_blank" rel="noopener">https://aws.amazon.com/tw/about-aws/whats-new/2025/12/amazon-ecs-managed-instances-ec2-spot-instances/</a>
</li>
</ul>
<h2 id="fast-nginx-task-startup-with-ecs-managed-instances">Fast Nginx Task Startup with ECS Managed Instances</h2>
<h2 id="ä½¿ç”¨-ecs-managed-instances-å¿«é€Ÿå•Ÿå‹•-nginx-ä»»å‹™">ä½¿ç”¨ ECS Managed Instances å¿«é€Ÿå•Ÿå‹• Nginx ä»»å‹™</h2>
<p>This project demonstrates how to use <strong>Amazon ECS Managed Instances</strong> with Terraform to quickly bring up an ECS service running Nginx.
æœ¬å°ˆæ¡ˆå±•ç¤ºå¦‚ä½•ä½¿ç”¨ Terraform æ­é… <strong>Amazon ECS Managed Instances</strong> å¿«é€Ÿå•Ÿå‹•é‹è¡Œ Nginx çš„ ECS æœå‹™ã€‚</p>
<p>We also measure how long it takes from requesting a single task to the moment the application starts logging â€” roughly <strong>40 seconds end-to-end</strong>.
æˆ‘å€‘ä¹Ÿæ¸¬é‡äº†å¾è«‹æ±‚å–®ä¸€ä»»å‹™åˆ°æ‡‰ç”¨ç¨‹å¼é–‹å§‹è¨˜éŒ„æ—¥èªŒæ‰€éœ€çš„æ™‚é–“ â€” ç«¯åˆ°ç«¯å¤§ç´„ <strong>40 ç§’</strong>ã€‚</p>
<ul>
<li>
<p><strong>Why ECS Managed Instances are interesting and useful</strong></p>
</li>
<li>
<p><strong>ç‚ºä»€éº¼ ECS Managed Instances å€¼å¾—é—œæ³¨ä¸”å¯¦ç”¨</strong></p>
</li>
<li>
<p><strong>What this Terraform example is doing at a high level</strong></p>
</li>
<li>
<p><strong>é€™å€‹ Terraform ç¯„ä¾‹åœ¨é«˜å±¤æ¬¡ä¸Šåšäº†ä»€éº¼</strong></p>
</li>
<li>
<p><strong>Measured time from &ldquo;no instances&rdquo; to &ldquo;first task running Nginx&rdquo;</strong></p>
</li>
<li>
<p><strong>æ¸¬é‡å¾ã€Œç„¡å¯¦ä¾‹ã€åˆ°ã€Œç¬¬ä¸€å€‹ Nginx ä»»å‹™é‹è¡Œã€çš„æ™‚é–“</strong></p>
</li>
</ul>
<hr>
<h2 id="why-care-about-ecs-managed-instances">Why Care About ECS Managed Instances?</h2>
<h2 id="ç‚ºä»€éº¼è¦é—œå¿ƒ-ecs-managed-instances">ç‚ºä»€éº¼è¦é—œå¿ƒ ECS Managed Instancesï¼Ÿ</h2>
<p>When running workloads (tasks / services) on ECS, we typically think in terms of two classic options:
ç•¶åœ¨ ECS ä¸Šé‹è¡Œå·¥ä½œè² è¼‰ï¼ˆä»»å‹™/æœå‹™ï¼‰æ™‚ï¼Œæˆ‘å€‘é€šå¸¸æœƒæƒ³åˆ°å…©ç¨®ç¶“å…¸é¸é …ï¼š</p>
<ul>
<li>
<p><strong>ECS on EC2</strong>: You manage Auto Scaling Groups, lifecycle, capacity, patching, etc.</p>
</li>
<li>
<p><strong>ECS on EC2</strong>ï¼šæ‚¨éœ€è¦è‡ªè¡Œç®¡ç† Auto Scaling Groupsã€ç”Ÿå‘½é€±æœŸã€å®¹é‡ã€ä¿®è£œç¨‹å¼ç­‰ã€‚</p>
</li>
<li>
<p><strong>ECS on Fargate</strong>: No EC2 management, but higher per-unit cost and some limitations on supported sizes.</p>
</li>
<li>
<p><strong>ECS on Fargate</strong>ï¼šç„¡éœ€ç®¡ç† EC2ï¼Œä½†å–®ä½æˆæœ¬è¼ƒé«˜ä¸”æ”¯æ´çš„è¦æ ¼æœ‰ä¸€äº›é™åˆ¶ã€‚</p>
</li>
</ul>
<p><strong>ECS Managed Instances</strong> sit somewhere in between:
<strong>ECS Managed Instances</strong> ä»‹æ–¼å…©è€…ä¹‹é–“ï¼š</p>
<ul>
<li>
<p>You still use EC2 instances (so you can leverage Graviton, Spot, flexible instance families, etc.).</p>
</li>
<li>
<p>æ‚¨ä»ç„¶ä½¿ç”¨ EC2 å¯¦ä¾‹ï¼ˆå› æ­¤å¯ä»¥åˆ©ç”¨ Gravitonã€Spotã€å½ˆæ€§å¯¦ä¾‹ç³»åˆ—ç­‰ï¼‰ã€‚</p>
</li>
<li>
<p>But you <strong>don&rsquo;t manage ASGs yourself</strong>. ECS uses a capacity provider to manage the EC2 instances for you â€” essentially &ldquo;auto-managed EC2 capacity powered by ECS&rdquo;.</p>
</li>
<li>
<p>ä½†æ‚¨<strong>ä¸éœ€è¦è‡ªå·±ç®¡ç† ASG</strong>ã€‚ECS ä½¿ç”¨å®¹é‡æä¾›è€…ç‚ºæ‚¨ç®¡ç† EC2 å¯¦ä¾‹ â€” æœ¬è³ªä¸Šæ˜¯ã€Œç”± ECS é©…å‹•çš„è‡ªå‹•ç®¡ç† EC2 å®¹é‡ã€ã€‚</p>
</li>
</ul>
<p>For SREs/platform teams, this means:
å°æ–¼ SRE/å¹³å°åœ˜éšŠä¾†èªªï¼Œé€™æ„å‘³è‘—ï¼š</p>
<ul>
<li>
<p>You define a <strong>pool of instances by attributes (instance requirements)</strong>, e.g. ARM architecture, 2 vCPUs, 4â€“6 GB memory, etc.</p>
</li>
<li>
<p>æ‚¨å¯ä»¥é€é<strong>å±¬æ€§ï¼ˆå¯¦ä¾‹éœ€æ±‚ï¼‰å®šç¾©ä¸€çµ„å¯¦ä¾‹æ± </strong>ï¼Œä¾‹å¦‚ ARM æ¶æ§‹ã€2 å€‹ vCPUã€4-6 GB è¨˜æ†¶é«”ç­‰ã€‚</p>
</li>
<li>
<p>You don&rsquo;t maintain ASGs and scaling policies directly; instead, you use an <strong>ECS capacity provider strategy</strong> to select capacity sources.</p>
</li>
<li>
<p>æ‚¨ä¸éœ€è¦ç›´æ¥ç¶­è­· ASG å’Œæ“´å±•ç­–ç•¥ï¼›ç›¸åï¼Œæ‚¨ä½¿ç”¨ <strong>ECS å®¹é‡æä¾›è€…ç­–ç•¥</strong>ä¾†é¸æ“‡å®¹é‡ä¾†æºã€‚</p>
</li>
<li>
<p>With CloudWatch Logs and Container Insights, the operational experience is close to Fargate, but the cost and flexibility look much more like EC2.</p>
</li>
<li>
<p>é€é CloudWatch Logs å’Œ Container Insightsï¼Œæ“ä½œé«”é©—æ¥è¿‘ Fargateï¼Œä½†æˆæœ¬å’Œå½ˆæ€§å‰‡æ›´åƒ EC2ã€‚</p>
</li>
</ul>
<hr>
<h2 id="terraform-example-architecture-overview">Terraform Example: Architecture Overview</h2>
<h2 id="terraform-ç¯„ä¾‹æ¶æ§‹æ¦‚è¿°">Terraform ç¯„ä¾‹ï¼šæ¶æ§‹æ¦‚è¿°</h2>
<h3 id="demo-repo-httpsgithubcomneilkuanecs-managed-instance-issue">Demo Repo: <a href="https://github.com" target="_blank" rel="noopener">https://github.com</a>
:neilkuan/ecs-managed-instance-issue</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git clone https://github.com:neilkuan/ecs-managed-instance-issue
</span></span></code></pre></div><p>The <code>main.tf</code> file wires everything together in <code>ap-east-2</code>. At a high level it does the following:
<code>main.tf</code> æª”æ¡ˆåœ¨ <code>ap-east-2</code> å€åŸŸå°‡æ‰€æœ‰å…ƒä»¶ä¸²æ¥åœ¨ä¸€èµ·ã€‚åœ¨é«˜å±¤æ¬¡ä¸Šï¼Œå®ƒåŸ·è¡Œä»¥ä¸‹æ“ä½œï¼š</p>
<ul>
<li>
<p><strong>Provider and Version Requirements</strong></p>
</li>
<li>
<p><strong>Provider å’Œç‰ˆæœ¬éœ€æ±‚</strong></p>
<ul>
<li>Uses the <code>hashicorp/aws</code> provider, version <code>&gt;= 6.25.0</code>, to support the <code>managed_instances_provider</code> configuration.</li>
<li>ä½¿ç”¨ <code>hashicorp/aws</code> providerï¼Œç‰ˆæœ¬ <code>&gt;= 6.25.0</code>ï¼Œä»¥æ”¯æ´ <code>managed_instances_provider</code> è¨­å®šã€‚</li>
</ul>
</li>
<li>
<p><strong>Networking and Security Groups</strong></p>
</li>
<li>
<p><strong>ç¶²è·¯å’Œå®‰å…¨ç¾¤çµ„</strong></p>
<ul>
<li>
<p>Uses <code>data &quot;aws_subnets&quot;</code> to fetch private subnets from an existing VPC.</p>
</li>
<li>
<p>ä½¿ç”¨ <code>data &quot;aws_subnets&quot;</code> å¾ç¾æœ‰ VPC ä¸­å–å¾—ç§æœ‰å­ç¶²è·¯ã€‚</p>
</li>
<li>
<p>Creates two security groups:</p>
</li>
<li>
<p>å»ºç«‹å…©å€‹å®‰å…¨ç¾¤çµ„ï¼š</p>
<ul>
<li>
<p><code>ecs_instances</code>: for EC2 instances, allowing outbound traffic.</p>
</li>
<li>
<p><code>ecs_instances</code>ï¼šç”¨æ–¼ EC2 å¯¦ä¾‹ï¼Œå…è¨±å‡ºç«™æµé‡ã€‚</p>
</li>
<li>
<p><code>ecs_tasks</code>: for ECS tasks, allowing inbound HTTP (port 80/tcp) so requests can reach Nginx.</p>
</li>
<li>
<p><code>ecs_tasks</code>ï¼šç”¨æ–¼ ECS ä»»å‹™ï¼Œå…è¨±å…¥ç«™ HTTPï¼ˆé€£æ¥åŸ  80/tcpï¼‰ï¼Œä»¥ä¾¿è«‹æ±‚å¯ä»¥åˆ°é” Nginxã€‚</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>IAM Roles and Instance Profile</strong></p>
</li>
<li>
<p><strong>IAM è§’è‰²å’Œå¯¦ä¾‹è¨­å®šæª”</strong></p>
<ul>
<li>
<p><code>ecs_infrastructure_role</code>: used by the ECS infrastructure (Managed Instances), attached with:</p>
</li>
<li>
<p><code>ecs_infrastructure_role</code>ï¼šç”± ECS åŸºç¤è¨­æ–½ï¼ˆManaged Instancesï¼‰ä½¿ç”¨ï¼Œé™„åŠ ï¼š</p>
<ul>
<li><code>arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForManagedInstances</code>.</li>
<li><code>arn:aws:iam::aws:policy/AmazonECSInfrastructureRolePolicyForManagedInstances</code>ã€‚</li>
</ul>
</li>
<li>
<p><code>ecs_instance_role</code>: used by EC2 instances, attached with:</p>
</li>
<li>
<p><code>ecs_instance_role</code>ï¼šç”± EC2 å¯¦ä¾‹ä½¿ç”¨ï¼Œé™„åŠ ï¼š</p>
<ul>
<li><code>AmazonEC2ContainerServiceforEC2Role</code></li>
<li><code>AmazonEC2ContainerServiceforEC2Role</code></li>
</ul>
</li>
<li>
<p><code>ecs_task_execution_role</code>: ECS task execution role, attached with:</p>
</li>
<li>
<p><code>ecs_task_execution_role</code>ï¼šECS ä»»å‹™åŸ·è¡Œè§’è‰²ï¼Œé™„åŠ ï¼š</p>
<ul>
<li><code>AmazonECSTaskExecutionRolePolicy</code> (image pulls, logging, etc.).</li>
<li><code>AmazonECSTaskExecutionRolePolicy</code>ï¼ˆæ˜ åƒæª”æ‹‰å–ã€æ—¥èªŒè¨˜éŒ„ç­‰ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>ECS Cluster and Capacity Provider</strong></p>
</li>
<li>
<p><strong>ECS å¢é›†å’Œå®¹é‡æä¾›è€…</strong></p>
<ul>
<li>
<p>Creates an ECS cluster: <code>managed-instances-cluster</code>.</p>
</li>
<li>
<p>å»ºç«‹ ECS å¢é›†ï¼š<code>managed-instances-cluster</code>ã€‚</p>
</li>
<li>
<p>Creates a capacity provider <code>managed-instances-cp</code> using <code>managed_instances_provider</code>:</p>
</li>
<li>
<p>ä½¿ç”¨ <code>managed_instances_provider</code> å»ºç«‹å®¹é‡æä¾›è€… <code>managed-instances-cp</code>ï¼š</p>
<ul>
<li>
<p>Sets <code>infrastructure_role_arn</code> and <code>instance_launch_template</code>.</p>
</li>
<li>
<p>è¨­å®š <code>infrastructure_role_arn</code> å’Œ <code>instance_launch_template</code>ã€‚</p>
</li>
<li>
<p>Uses <code>instance_requirements</code> to define the desired EC2 pool:</p>
</li>
<li>
<p>ä½¿ç”¨ <code>instance_requirements</code> å®šç¾©æ‰€éœ€çš„ EC2 æ± ï¼š</p>
<ul>
<li>
<p>vCPU between 2â€“4, memory between 3â€“6 GiB.</p>
</li>
<li>
<p>vCPU ä»‹æ–¼ 2-4 ä¹‹é–“ï¼Œè¨˜æ†¶é«”ä»‹æ–¼ 3-6 GiB ä¹‹é–“ã€‚</p>
</li>
<li>
<p><code>cpu_manufacturers = [&quot;amazon-web-services&quot;]</code> to prefer Graviton (e.g. t4g, c7g, m7g).</p>
</li>
<li>
<p><code>cpu_manufacturers = [&quot;amazon-web-services&quot;]</code> ä»¥å„ªå…ˆä½¿ç”¨ Gravitonï¼ˆä¾‹å¦‚ t4gã€c7gã€m7gï¼‰ã€‚</p>
</li>
<li>
<p>Excludes very small instance types (<code>t4g.nano</code>, <code>t4g.micro</code>, <code>t4g.small</code>).</p>
</li>
<li>
<p>æ’é™¤éå¸¸å°çš„å¯¦ä¾‹é¡å‹ï¼ˆ<code>t4g.nano</code>ã€<code>t4g.micro</code>ã€<code>t4g.small</code>ï¼‰ã€‚</p>
</li>
</ul>
</li>
<li>
<p>Configures <code>network_configuration</code> to use private subnets and the <code>ecs_instances</code> security group.</p>
</li>
<li>
<p>è¨­å®š <code>network_configuration</code> ä»¥ä½¿ç”¨ç§æœ‰å­ç¶²è·¯å’Œ <code>ecs_instances</code> å®‰å…¨ç¾¤çµ„ã€‚</p>
</li>
<li>
<p>Defines <code>storage_configuration</code> and sets <code>monitoring = &quot;BASIC&quot;</code>.</p>
</li>
<li>
<p>å®šç¾© <code>storage_configuration</code> ä¸¦è¨­å®š <code>monitoring = &quot;BASIC&quot;</code>ã€‚</p>
</li>
</ul>
</li>
<li>
<p>Uses <code>aws_ecs_cluster_capacity_providers</code> to attach the capacity provider to the cluster and make it the default strategy.</p>
</li>
<li>
<p>ä½¿ç”¨ <code>aws_ecs_cluster_capacity_providers</code> å°‡å®¹é‡æä¾›è€…é™„åŠ åˆ°å¢é›†ä¸¦å°‡å…¶è¨­ç‚ºé è¨­ç­–ç•¥ã€‚</p>
</li>
</ul>
</li>
<li>
<p><strong>Task Definition and Nginx Service</strong></p>
</li>
<li>
<p><strong>ä»»å‹™å®šç¾©å’Œ Nginx æœå‹™</strong></p>
<ul>
<li>
<p>Task definition <code>nginx-task</code>:</p>
</li>
<li>
<p>ä»»å‹™å®šç¾© <code>nginx-task</code>ï¼š</p>
<ul>
<li>
<p><code>network_mode = &quot;awsvpc&quot;</code> and <code>requires_compatibilities = [&quot;EC2&quot;, &quot;MANAGED_INSTANCES&quot;]</code>.</p>
</li>
<li>
<p><code>network_mode = &quot;awsvpc&quot;</code> ä¸” <code>requires_compatibilities = [&quot;EC2&quot;, &quot;MANAGED_INSTANCES&quot;]</code>ã€‚</p>
</li>
<li>
<p><code>runtime_platform</code> set to <code>LINUX</code> with <code>ARM64</code> to match Graviton instances.</p>
</li>
<li>
<p><code>runtime_platform</code> è¨­å®šç‚º <code>LINUX</code> æ­é… <code>ARM64</code> ä»¥åŒ¹é… Graviton å¯¦ä¾‹ã€‚</p>
</li>
<li>
<p>Container image: <code>public.ecr.aws/nginx/nginx:1.27-alpine-arm64v8</code>, exposing port 80 and sending logs to CloudWatch Logs (<code>/ecs/nginx-managed-instances</code>) via <code>awslogs</code>.</p>
</li>
<li>
<p>å®¹å™¨æ˜ åƒæª”ï¼š<code>public.ecr.aws/nginx/nginx:1.27-alpine-arm64v8</code>ï¼Œæš´éœ²é€£æ¥åŸ  80 ä¸¦é€é <code>awslogs</code> å°‡æ—¥èªŒå‚³é€åˆ° CloudWatch Logsï¼ˆ<code>/ecs/nginx-managed-instances</code>ï¼‰ã€‚</p>
</li>
</ul>
</li>
<li>
<p>ECS service <code>nginx-service</code>:</p>
</li>
<li>
<p>ECS æœå‹™ <code>nginx-service</code>ï¼š</p>
<ul>
<li>
<p><code>desired_count = 1</code> and a <code>capacity_provider_strategy</code> pointing to <code>managed-instances-cp</code>.</p>
</li>
<li>
<p><code>desired_count = 1</code> ä¸” <code>capacity_provider_strategy</code> æŒ‡å‘ <code>managed-instances-cp</code>ã€‚</p>
</li>
<li>
<p>Uses the same private subnets and the <code>ecs_tasks</code> security group.</p>
</li>
<li>
<p>ä½¿ç”¨ç›¸åŒçš„ç§æœ‰å­ç¶²è·¯å’Œ <code>ecs_tasks</code> å®‰å…¨ç¾¤çµ„ã€‚</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>In other words, with a single <code>terraform apply</code> you get:
æ›å¥è©±èªªï¼Œé€éå–®ä¸€ <code>terraform apply</code> æ‚¨å¯ä»¥ç²å¾—ï¼š</p>
<ul>
<li>
<p>An ECS cluster backed by ECS Managed Instances.</p>
</li>
<li>
<p>ç”± ECS Managed Instances æ”¯æ’çš„ ECS å¢é›†ã€‚</p>
</li>
<li>
<p>A service that triggers ECS to spin up EC2 capacity and then launch an Nginx task.</p>
</li>
<li>
<p>è§¸ç™¼ ECS å•Ÿå‹• EC2 å®¹é‡ä¸¦åŸ·è¡Œ Nginx ä»»å‹™çš„æœå‹™ã€‚</p>
</li>
<li>
<p>CloudWatch Logs and basic monitoring already wired in.</p>
</li>
<li>
<p>å·²é å…ˆè¨­å®šå¥½çš„ CloudWatch Logs å’ŒåŸºæœ¬ç›£æ§ã€‚</p>
</li>
</ul>
<h2 id="example-deploy-demo-infra">Example Deploy Demo Infra</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># init </span>
</span></span><span style="display:flex;"><span>terraform init
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># apply</span>
</span></span><span style="display:flex;"><span>terraform apply
</span></span></code></pre></div><p><img src="/img/2026-01-17-ecs-managed-instance/0-1.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># Destroy</span>
</span></span><span style="display:flex;"><span>terraform destroy
</span></span></code></pre></div><hr>
<h2 id="measuring-cold-start-from-requesting-1-task-to-nginx-logging">Measuring Cold Start: From Requesting 1 Task to Nginx Logging</h2>
<h2 id="æ¸¬é‡å†·å•Ÿå‹•å¾è«‹æ±‚-1-å€‹ä»»å‹™åˆ°-nginx-è¨˜éŒ„æ—¥èªŒ">æ¸¬é‡å†·å•Ÿå‹•ï¼šå¾è«‹æ±‚ 1 å€‹ä»»å‹™åˆ° Nginx è¨˜éŒ„æ—¥èªŒ</h2>
<p>To understand the cold-start behavior of Managed Instances, we used a small script that continuously lists container instances in the cluster.
ç‚ºäº†äº†è§£ Managed Instances çš„å†·å•Ÿå‹•è¡Œç‚ºï¼Œæˆ‘å€‘ä½¿ç”¨äº†ä¸€å€‹å°è…³æœ¬æŒçºŒåˆ—å‡ºå¢é›†ä¸­çš„å®¹å™¨å¯¦ä¾‹ã€‚</p>
<h3 id="monitoring-script">Monitoring Script</h3>
<h3 id="ç›£æ§è…³æœ¬">ç›£æ§è…³æœ¬</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash -c <span style="color:#f1fa8c">&#39;while true; do date &amp;&amp; aws ecs list-container-instances --cluster managed-instances-cluster;done&#39;</span>
</span></span></code></pre></div><p>This prints the current time and the result of <code>aws ecs list-container-instances</code> every second so we can see:
é€™æœƒæ¯ç§’åˆ—å°ç•¶å‰æ™‚é–“å’Œ <code>aws ecs list-container-instances</code> çš„çµæœï¼Œè®“æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼š</p>
<ul>
<li>
<p>When there are no EC2 instances registered to the cluster.</p>
</li>
<li>
<p>å¢é›†ä¸­ä½•æ™‚æ²’æœ‰å·²è¨»å†Šçš„ EC2 å¯¦ä¾‹ã€‚</p>
</li>
<li>
<p>When the first managed instance appears and registers with ECS.</p>
</li>
<li>
<p>ç¬¬ä¸€å€‹å—ç®¡å¯¦ä¾‹ä½•æ™‚å‡ºç¾ä¸¦è¨»å†Šåˆ° ECSã€‚</p>
</li>
</ul>
<h3 id="timeline-and-results">Timeline and Results</h3>
<h3 id="æ™‚é–“ç·šå’Œçµæœ">æ™‚é–“ç·šå’Œçµæœ</h3>
<p>Here&rsquo;s the timeline from &ldquo;requesting 1 Nginx task&rdquo; to &ldquo;Nginx starting to write logs&rdquo;:
ä»¥ä¸‹æ˜¯å¾ã€Œè«‹æ±‚ 1 å€‹ Nginx ä»»å‹™ã€åˆ°ã€ŒNginx é–‹å§‹å¯«å…¥æ—¥èªŒã€çš„æ™‚é–“ç·šï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>17:04:46 request <span style="color:#bd93f9">1</span> task 
</span></span><span style="display:flex;"><span>-&gt; <span style="color:#ff79c6">(</span>19s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>17:05:5 container instance running <span style="color:#ff79c6">(</span>c6g.large<span style="color:#ff79c6">)</span> 
</span></span><span style="display:flex;"><span>-&gt; <span style="color:#ff79c6">(</span>15s<span style="color:#ff79c6">)</span>  <span style="color:#ff79c6">(</span>pending<span style="color:#ff79c6">)</span> -&gt; <span style="color:#ff79c6">(</span>running<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>17:05:20 task running 
</span></span><span style="display:flex;"><span>-&gt; <span style="color:#ff79c6">(</span>7s<span style="color:#ff79c6">)</span>
</span></span><span style="display:flex;"><span>17:05:27 application <span style="color:#ff79c6">(</span>nginx<span style="color:#ff79c6">)</span> logging
</span></span></code></pre></div><p>Interpreted step-by-step:
é€æ­¥è§£è®€ï¼š</p>
<ul>
<li>
<p><strong>0s</strong>: Request to start one Nginx task on <code>managed-instances-cluster</code>.</p>
</li>
<li>
<p><strong>0 ç§’</strong>ï¼šè«‹æ±‚åœ¨ <code>managed-instances-cluster</code> ä¸Šå•Ÿå‹•ä¸€å€‹ Nginx ä»»å‹™ã€‚</p>
</li>
<li>
<p><img src="/img/2026-01-17-ecs-managed-instance/0.png" alt=""></p>
</li>
<li>
<p><img src="/img/2026-01-17-ecs-managed-instance/1.png" alt=""></p>
</li>
<li>
<p><strong>~19s later</strong>: The first managed instance (in this run, <code>c6g.large</code>) is launched and registered to the ECS cluster.</p>
</li>
<li>
<p><strong>ç´„ 19 ç§’å¾Œ</strong>ï¼šç¬¬ä¸€å€‹å—ç®¡å¯¦ä¾‹ï¼ˆæ­¤æ¬¡åŸ·è¡Œç‚º <code>c6g.large</code>ï¼‰å•Ÿå‹•ä¸¦è¨»å†Šåˆ° ECS å¢é›†ã€‚</p>
</li>
<li>
<p><img src="/img/2026-01-17-ecs-managed-instance/2.png" alt=""></p>
</li>
<li>
<p><strong>~15s after that</strong>: The ECS task reaches <code>RUNNING</code> state.</p>
</li>
<li>
<p><strong>ä¹‹å¾Œç´„ 15 ç§’</strong>ï¼šECS ä»»å‹™é”åˆ° <code>RUNNING</code> ç‹€æ…‹ã€‚</p>
</li>
<li>
<p><img src="/img/2026-01-17-ecs-managed-instance/3.png" alt=""></p>
</li>
<li>
<p><strong>~7s later</strong>: Nginx starts writing application logs to CloudWatch Logs.</p>
</li>
<li>
<p><strong>å†éç´„ 7 ç§’</strong>ï¼šNginx é–‹å§‹å°‡æ‡‰ç”¨ç¨‹å¼æ—¥èªŒå¯«å…¥ CloudWatch Logsã€‚</p>
</li>
<li>
<p><img src="/img/2026-01-17-ecs-managed-instance/5.png" alt=""></p>
</li>
<li>
<p><img src="/img/2026-01-17-ecs-managed-instance/6.png" alt=""></p>
</li>
</ul>
<p>So, from &ldquo;no container instances at all&rdquo; to &ldquo;Nginx actually serving and logging&rdquo; you&rsquo;re looking at roughly:
å› æ­¤ï¼Œå¾ã€Œå®Œå…¨æ²’æœ‰å®¹å™¨å¯¦ä¾‹ã€åˆ°ã€ŒNginx å¯¦éš›æœå‹™ä¸¦è¨˜éŒ„æ—¥èªŒã€å¤§ç´„éœ€è¦ï¼š</p>
<blockquote>
<p><strong>19s (bring up EC2 + register) + 15s (pull image &amp; start container) + 7s (app startup &amp; first logs) â‰’ 41 seconds</strong>
<strong>19 ç§’ï¼ˆå•Ÿå‹• EC2 + è¨»å†Šï¼‰+ 15 ç§’ï¼ˆæ‹‰å–æ˜ åƒæª” &amp; å•Ÿå‹•å®¹å™¨ï¼‰+ 7 ç§’ï¼ˆæ‡‰ç”¨ç¨‹å¼å•Ÿå‹• &amp; é¦–æ¬¡æ—¥èªŒï¼‰â‰’ 41 ç§’</strong></p>
</blockquote>
<p>For many back-office services, internal tools, or low-QPS control-plane style workloads:
å°æ–¼è¨±å¤šå¾Œå°æœå‹™ã€å…§éƒ¨å·¥å…·æˆ–ä½ QPS æ§åˆ¶å¹³é¢é¡å‹çš„å·¥ä½œè² è¼‰ï¼š</p>
<ul>
<li>
<p>This cold-start time is perfectly reasonable.</p>
</li>
<li>
<p>é€™å€‹å†·å•Ÿå‹•æ™‚é–“å®Œå…¨åˆç†ã€‚</p>
</li>
<li>
<p>You still gain the cost benefits and flexibility of EC2/Graviton.</p>
</li>
<li>
<p>æ‚¨ä»ç„¶å¯ä»¥ç²å¾— EC2/Graviton çš„æˆæœ¬å„ªå‹¢å’Œå½ˆæ€§ã€‚</p>
</li>
</ul>
<hr>
<h2 id="when-to-consider-ecs-managed-instances">When to Consider ECS Managed Instances</h2>
<h2 id="ä½•æ™‚è€ƒæ…®ä½¿ç”¨-ecs-managed-instances">ä½•æ™‚è€ƒæ…®ä½¿ç”¨ ECS Managed Instances</h2>
<p>Some scenarios where ECS Managed Instances can be a great fit:
ä»¥ä¸‹æ˜¯ ECS Managed Instances éå¸¸é©åˆçš„ä¸€äº›å ´æ™¯ï¼š</p>
<ul>
<li>
<p><strong>You want EC2 flexibility and cost-efficiency without maintaining ASGs yourself.</strong></p>
</li>
<li>
<p><strong>æ‚¨æƒ³è¦ EC2 çš„å½ˆæ€§å’Œæˆæœ¬æ•ˆç›Šï¼Œä½†ä¸æƒ³è‡ªå·±ç¶­è­· ASGã€‚</strong></p>
</li>
<li>
<p><strong>Your workloads are bursty or intermittent</strong>, and you&rsquo;re okay with tens of seconds of cold start to avoid paying for idle EC2 capacity.</p>
</li>
<li>
<p><strong>æ‚¨çš„å·¥ä½œè² è¼‰å…·æœ‰çªç™¼æ€§æˆ–é–“æ­‡æ€§</strong>ï¼Œæ‚¨å¯ä»¥æ¥å—æ•¸åç§’çš„å†·å•Ÿå‹•æ™‚é–“ï¼Œä»¥é¿å…ç‚ºé–’ç½®çš„ EC2 å®¹é‡ä»˜è²»ã€‚</p>
</li>
<li>
<p><strong>You need specific instance attributes</strong> (e.g. must run on Graviton, must have local NVMe, or must leverage Spot), but still want to orchestrate everything using ECS capacity provider strategies.</p>
</li>
<li>
<p><strong>æ‚¨éœ€è¦ç‰¹å®šçš„å¯¦ä¾‹å±¬æ€§</strong>ï¼ˆä¾‹å¦‚å¿…é ˆåœ¨ Graviton ä¸Šé‹è¡Œã€å¿…é ˆæœ‰æœ¬åœ° NVMeã€æˆ–å¿…é ˆåˆ©ç”¨ Spotï¼‰ï¼Œä½†ä»å¸Œæœ›ä½¿ç”¨ ECS å®¹é‡æä¾›è€…ç­–ç•¥ä¾†ç·¨æ’ä¸€åˆ‡ã€‚</p>
</li>
</ul>
<p>If you&rsquo;re already familiar with ECS on EC2 or Fargate and want a <strong>more hands-off way of managing EC2 capacity</strong>, this <code>ecs-mg</code> example is a good starting point.
å¦‚æœæ‚¨å·²ç¶“ç†Ÿæ‚‰ ECS on EC2 æˆ– Fargateï¼Œä¸¦ä¸”æƒ³è¦ä¸€ç¨®<strong>æ›´çœäº‹çš„ EC2 å®¹é‡ç®¡ç†æ–¹å¼</strong>ï¼Œé€™å€‹ <code>ecs-mg</code> ç¯„ä¾‹æ˜¯ä¸€å€‹å¾ˆå¥½çš„èµ·é»ã€‚</p>
<p>Just run <code>terraform apply</code>, watch the cluster come to life, and observe how Managed Instances handle capacity and cold starts for your Nginx service.
åªéœ€åŸ·è¡Œ <code>terraform apply</code>ï¼Œè§€å¯Ÿå¢é›†å•Ÿå‹•ï¼Œä¸¦è§€å¯Ÿ Managed Instances å¦‚ä½•ç‚ºæ‚¨çš„ Nginx æœå‹™è™•ç†å®¹é‡å’Œå†·å•Ÿå‹•ã€‚</p>
<hr>
<h2 id="findings--ç™¼ç¾ä¸€äº›äº‹æƒ…">Findings / ç™¼ç¾ä¸€äº›äº‹æƒ…</h2>
<h3 id="1-ecs-service-connect-with-ecs-exec-on-managed-instance-has-connection-issues">1. ECS Service Connect with ECS Exec on Managed Instance has connection issues</h3>
<h3 id="1-ç•¶-ecs-service-connect-èˆ‡-ecs-exec-åŒæ™‚å•Ÿç”¨æ™‚managed-instance-ä¸Šçš„-task-ç„¡æ³•æ­£å¸¸é€£ç·š">1. ç•¶ ECS Service Connect èˆ‡ ECS Exec åŒæ™‚å•Ÿç”¨æ™‚ï¼ŒManaged Instance ä¸Šçš„ Task ç„¡æ³•æ­£å¸¸é€£ç·š</h3>
<blockquote>
<p>If you deploy this Terraform example repo, the <code>nginx-service</code> will enable both ECS Service Connect and ECS Exec running on Managed Instance.</p>
<p>å¦‚æœä½ éƒ¨ç½²äº†é€™å€‹ Terraform ç¯„ä¾‹ï¼Œ<code>nginx-service</code> æœƒåŒæ™‚é–‹å•Ÿ ECS Service Connect ä»¥åŠ ECS Execï¼Œä¸¦é‹è¡Œæ–¼ Managed Instance ä¸Šã€‚</p>
</blockquote>
<p><strong>Example / ç¯„ä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>aws ecs list-services --cluster managed-instances-cluster --region ap-east-2 --query <span style="color:#f1fa8c">&#39;serviceArns[]&#39;</span> --output table
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># ------------------------------------------------------------------------------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># |                                         ListServices                                         |</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># +----------------------------------------------------------------------------------------------+</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># |  arn:aws:ecs:ap-east-2:012345678912:service/managed-instances-cluster/nginx-service-exec-ok  |</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># |  arn:aws:ecs:ap-east-2:012345678912:service/managed-instances-cluster/nginx-service-fargate  |</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># |  arn:aws:ecs:ap-east-2:012345678912:service/managed-instances-cluster/nginx-service          |</span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># +----------------------------------------------------------------------------------------------+</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bash scripts/check-exec-connect.bash <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --cluster managed-instances-cluster <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --region ap-east-2 <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --service nginx-service
</span></span></code></pre></div><p><img src="/img/2026-01-17-ecs-managed-instance/nginx-service.png" alt=""></p>
<hr>
<blockquote>
<p>The <code>nginx-service-exec-ok</code> service only enables ECS Exec running on Managed Instance.</p>
<p><code>nginx-service-exec-ok</code> æœå‹™åƒ…é–‹å•Ÿ ECS Execï¼Œé‹è¡Œæ–¼ Managed Instance ä¸Šã€‚</p>
</blockquote>
<p><strong>Example / ç¯„ä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash scripts/check-exec-connect.bash <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --cluster managed-instances-cluster <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --region ap-east-2 <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --service nginx-service-exec-ok
</span></span></code></pre></div><p><img src="/img/2026-01-17-ecs-managed-instance/nginx-service-exec-ok.png" alt=""></p>
<hr>
<blockquote>
<p>The <code>nginx-service-fargate</code> service enables both ECS Service Connect and ECS Exec running on Fargate.</p>
<p><code>nginx-service-fargate</code> æœå‹™åŒæ™‚é–‹å•Ÿ ECS Service Connect ä»¥åŠ ECS Execï¼Œé‹è¡Œæ–¼ Fargate ä¸Šã€‚</p>
</blockquote>
<p><strong>Example / ç¯„ä¾‹ï¼š</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>bash scripts/check-exec-connect.bash <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --cluster managed-instances-cluster <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --region ap-east-2 <span style="color:#f1fa8c">\
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c"></span>  --service nginx-service-fargate
</span></span></code></pre></div><p><img src="/img/2026-01-17-ecs-managed-instance/nginx-service-fargate.png" alt=""></p>
<hr>
<h3 id="summary-table--ç¸½çµè¡¨æ ¼">Summary Table / ç¸½çµè¡¨æ ¼</h3>
<table>
<thead>
<tr>
<th style="text-align:left">Service Name</th>
<th style="text-align:left">Launch Type</th>
<th style="text-align:center">ECS Service Connect</th>
<th style="text-align:center">ECS Exec</th>
<th style="text-align:center">Result</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>nginx-service</code></td>
<td style="text-align:left">Managed Instance (EC2)</td>
<td style="text-align:center">âœ… Enabled</td>
<td style="text-align:center">âœ… Enabled</td>
<td style="text-align:center">âŒ <strong>Connection Failed</strong></td>
</tr>
<tr>
<td style="text-align:left"><code>nginx-service-exec-ok</code></td>
<td style="text-align:left">Managed Instance (EC2)</td>
<td style="text-align:center">âŒ Disabled</td>
<td style="text-align:center">âœ… Enabled</td>
<td style="text-align:center">âœ… <strong>Works</strong></td>
</tr>
<tr>
<td style="text-align:left"><code>nginx-service-fargate</code></td>
<td style="text-align:left">Fargate</td>
<td style="text-align:center">âœ… Enabled</td>
<td style="text-align:center">âœ… Enabled</td>
<td style="text-align:center">âœ… <strong>Works</strong></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left">æœå‹™åç¨±</th>
<th style="text-align:left">å•Ÿå‹•é¡å‹</th>
<th style="text-align:center">ECS Service Connect</th>
<th style="text-align:center">ECS Exec</th>
<th style="text-align:center">çµæœ</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>nginx-service</code></td>
<td style="text-align:left">Managed Instance (EC2)</td>
<td style="text-align:center">âœ… å•Ÿç”¨</td>
<td style="text-align:center">âœ… å•Ÿç”¨</td>
<td style="text-align:center">âŒ <strong>é€£ç·šå¤±æ•—</strong></td>
</tr>
<tr>
<td style="text-align:left"><code>nginx-service-exec-ok</code></td>
<td style="text-align:left">Managed Instance (EC2)</td>
<td style="text-align:center">âŒ åœç”¨</td>
<td style="text-align:center">âœ… å•Ÿç”¨</td>
<td style="text-align:center">âœ… <strong>æ­£å¸¸</strong></td>
</tr>
<tr>
<td style="text-align:left"><code>nginx-service-fargate</code></td>
<td style="text-align:left">Fargate</td>
<td style="text-align:center">âœ… å•Ÿç”¨</td>
<td style="text-align:center">âœ… å•Ÿç”¨</td>
<td style="text-align:center">âœ… <strong>æ­£å¸¸</strong></td>
</tr>
</tbody>
</table>
<h3 id="architecture-diagram--æ¶æ§‹æ„è±¡åœ–">Architecture Diagram / æ¶æ§‹æ„è±¡åœ–</h3>
<p><img src="/img/2026-01-17-ecs-managed-instance/summary.png" alt=""></p>
<h3 id="conclusion--çµè«–">Conclusion / çµè«–</h3>
<blockquote>
<p><strong>Issue</strong>: When both ECS Service Connect and ECS Exec are enabled on a Managed Instance (EC2), the ECS Exec connection fails.</p>
<p><strong>å•é¡Œ</strong>ï¼šç•¶ Managed Instance (EC2) åŒæ™‚å•Ÿç”¨ ECS Service Connect èˆ‡ ECS Exec æ™‚ï¼ŒECS Exec é€£ç·šæœƒå¤±æ•—ã€‚</p>
</blockquote>
<blockquote>
<p><strong>Workaround</strong>: Either disable ECS Service Connect on Managed Instance, or use Fargate instead.</p>
<p><strong>è§£æ±ºæ–¹æ³•</strong>ï¼šåœ¨ Managed Instance ä¸Šåœç”¨ ECS Service Connectï¼Œæˆ–æ”¹ç”¨ Fargateã€‚</p>
</blockquote>
<h2 id="-this-issue-was-reported-to-aws-support-on-20251225-and-is-currently-awaiting-a-response">ğŸš¨ğŸš¨ğŸš¨ This issue was reported to AWS Support on 2025/12/25 and is currently awaiting a response.</h2>
<h2 id="-è©²å•é¡Œå·²ç¶“åœ¨-20251225-å›å ±çµ¦-aws-supportç›®å‰ç­‰å¾…å›æ‡‰ä¸­">ğŸš¨ğŸš¨ğŸš¨ è©²å•é¡Œå·²ç¶“åœ¨ 2025/12/25 å›å ±çµ¦ AWS Supportï¼Œç›®å‰ç­‰å¾…å›æ‡‰ä¸­</h2>
<h2 id="2026-01-17-neil-kuan-updated">2026-01-17 Neil Kuan Updated</h2>

  </article><div class="bg-blue-100 dark:bg-gray-900">
  <div class="container px-4 py-12 mx-auto max-w-4xl grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
    <div>
      <div class="text-2xl font-bold mb-2">Follow me</div>
      <p class="opacity-60">Here&#39;s where I hang out in social media</p>
    </div>

    <ul class="flex justify-center gap-x-3 flex-wrap gap-y-2">
      

      

      

      

      

      
      <li>
        <a
          href="https://github.com/neilkuan"
          target="_blank"
          rel="noopener"
          aria-label="GitHub"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <path
              d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5"
            />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
      <li>
        <a
          href="https://www.linkedin.com/in/neilkuan/"
          target="_blank"
          rel="noopener"
          aria-label="LinkedIn"
          class="p-1 inline-block rounded-full border border-transparent text-gray-500 hover:text-gray-800 hover:border-gray-800 cursor-pointer transition-colors dark:text-gray-600 dark:hover:border-gray-300 dark:hover:text-gray-300"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            fill="none"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path stroke="none" d="M0 0h24v24H0z" fill="none" />
            <rect x="4" y="4" width="16" height="16" rx="2" />
            <line x1="8" y1="11" x2="8" y2="16" />
            <line x1="8" y1="8" x2="8" y2="8.01" />
            <line x1="12" y1="16" x2="12" y2="11" />
            <path d="M16 16v-3a2 2 0 0 0 -4 0" />
          </svg>
        </a>
      </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      
    </ul>
  </div>
</div>

    </main><footer class="container p-6 mx-auto flex justify-between items-center">
  <span class="text-sm font-light">
    
    Â© 2019-Now Neil Kuan @neil_kuan.
    
  </span>
  <span onclick="window.scrollTo({top: 0, behavior: 'smooth'})" class="p-1 cursor-pointer">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24" stroke-width="1.5"
      stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M18 15l-6 -6l-6 6h12" />
    </svg>
  </span>
</footer>

<div class="search-ui absolute top-0 left-0 w-full h-full bg-white dark:bg-gray-800 hidden">
  <div class="container max-w-3xl mx-auto p-12">
    <div class="relative">
      <div class="my-4 text-center text-2xl font-bold">Search</div>

      <span class="p-2 absolute right-0 top-0 cursor-pointer close-search">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" stroke-width="1.5"
          stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
          <path stroke="none" d="M0 0h24v24H0z" fill="none" />
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </span>
    </div>

    <input type="search" class="py-2 px-3 w-full dark:text-black border dark:border-transparent"
      placeholder="Enter search query" />

    <div class="search-results text-lg font-medium my-4 hidden">Results</div>
    <ul class="search-list my-2">

    </ul>

    <div class="no-results text-center my-8 hidden">
      <div class="text-xl font-semibold mb-2">No results found</div>
      <p class="font-light text-sm">Try adjusting your search query</p>
    </div>
  </div>
</div>





<script src="https://blog.neilkuan.click/js/scripts.min.js"></script>






<script>
  
  const darkmode = document.querySelector('.toggle-dark-mode');
  function toggleDarkMode() {
    if (document.documentElement.classList.contains('dark')) {
      document.documentElement.classList.remove('dark')
      localStorage.setItem('darkmode', 'light')
    } else {
      document.documentElement.classList.add('dark')
      localStorage.setItem('darkmode', 'dark')
    }
  }
  if (darkmode) {
    darkmode.addEventListener('click', toggleDarkMode);
  }

  const darkStorage = localStorage.getItem('darkmode');
  const isBrowserDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

  if (!darkStorage && isBrowserDark) {
    document.documentElement.classList.add('dark');
  }

  if (darkStorage && darkStorage === 'dark') {
    toggleDarkMode();
  }
</script>


<script>
  const mobileMenuButton = document.querySelector('.mobile-menu-button')
  const mobileMenu = document.querySelector('.mobile-menu')
  function toggleMenu() {
    mobileMenu.classList.toggle('hidden');
    mobileMenu.classList.toggle('flex');
  }
  if(mobileMenu && mobileMenuButton){
    mobileMenuButton.addEventListener('click', toggleMenu)
  }
</script>
</body>
</html>
